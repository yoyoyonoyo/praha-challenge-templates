## 課題3-1

[課題2](https://www.notion.so/ab782bceba3c45b8bcada7551abb2d8b?pvs=21)の単体テストを書くためには、依存性の注入とモック化を行う必要がありました。

そもそも、なぜ元の関数はカバレッジ100%のテストを書けなかったのでしょうか？

### A

functionのテストではメソッド内部でその他のクラスを定義しているため、そこをモック化、もしくはDIに変えないと１００％にならなかった。

nameApiServiceにおいて、APIをモックしないとその都度の状況でレスポンスが変わるため１００％のテストができない。

## 課題3-2

依存性の注入とは何でしょうか？どのような問題を解決するために考案されたのでしょうか？

### A

- 結合度の低減
  - オブジェクト感の結合度が低くなり、コードの変更が容易
- テスト容易性
  - 依存関係が低くなるのでテストしやすい
- 柔軟性・再利用性の向上
  - 他のコンテキストでも再利用しやすい

## 課題3-3

`getFirstNameThrowIfLong`の関数は[https://random-data-api.com](https://random-data-api.xn--com-u63bk2a8fsa8im57aia3a8g86a5dv4bs207bqxxb/)からデータを取得しているようです。しかしテストの度に外部サービスと通信をするようでは、良い単体テストにならない可能性があります。今回のような単体テストで外部サービスとの通信が発生すると、どのようなデメリットがあるでしょうか？

### A

サービスの状況によってtest結果がブレる

## 課題3-4 \*任意

テストには「単体テスト」「統合テスト」など様々な分類や定義があります。
チーム内で「何を単体テストと呼ぶのか」「何を統合テストと呼ぶのか」など用語の定義集を作ってみても面白いかもしれません。

### A

ファイル単体のテスト→単体テスト
ファイル２個以上のテスト→結合テスト

## 課題3-5

`sumOfArray`に空の配列を渡すと例外が発生します。あまり好ましい挙動ではありません。
なぜあまり好ましい挙動ではないのでしょうか？
「こうなるべきだ」とご自身が考える形にコードを修正してみてください。

<aside>
💡 reduceの初期値に0を設定する、空配列だったら即座に0を返すなど、実行時例外が発生しない形に修正できないでしょうか？

</aside>

### A

修正

## 課題3-6

コードを修正したら、先ほど書いた単体テストが落ちるはずです。
全ての単体テストが通るよう、単体テストも修正してください。

### A

修正

## 課題3-7

単体テストを作成する際は、挙動が変わる境界値を検討したり、テストで保証しなければならない挙動を開発者自身が事前に考えておく必要があります。しかし複雑な機能をテストする場合あらかじめ全てのテストケースを開発者が想定しきることは難しいかもしれません。

「この特定の値の時だけ不具合が起きる」ケースを開発者が見落としてしまうと、テストケースが不完全になってしまいます。そんな時に役立つかもしれない概念として「Property Based Testing（プロパティベースのテスト）」があります（対照的な存在としてはExample Based Testingが挙げられます）。

なぜこのテストの考え方がコード品質を向上してくれる可能性があるのでしょうか？
逆に採用しない方が良いケースはあるのでしょうか？

### A

Property Based Testing（プロパティベースのテスト）
https://qiita.com/kiwa-y/items/354744ef7393d07a8928

https://medium.com/blockchain-engineer-blog/c-%E3%81%A7%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E3%83%99%E3%83%BC%E3%82%B9%E3%83%86%E3%82%B9%E3%83%88-f8d6be9bbd48

> なぜこのテストの考え方がコード品質を向上してくれる可能性があるのでしょうか？

- 入力値のカバレッジが広くなること
- バグ発見率の向上
- 再現性が高い

> 逆に採用しない方が良いケースはあるのでしょうか？

- 単純なケース
- パフォーマンスが重要な場合
- プロパティが定義し辛い場合

## 課題3-8

単体テストケースを増やしても可読性、保守性、実行速度などに問題が起きないよう工夫できることを3つ考えてみましょう。

例: `arrange-act-assert`パターンを採用する、など

<aside>
💡 特定の領域に関するベストプラクティスを探すときは「〇〇」と「pattern」といった単語を組み合わせて検索してみると役立つ知識が集めやすいかもしれません。
今回の例だと「unit test pattern」とか！
</aside>

### A

- AAAパターンを採用
- テストを定期的にリファクタリングする
- GIVEN WHEN THENパターン
